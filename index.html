<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>时笺祝福 | 岁月纪念墙</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@200;300;400;600;700&family=Ma+Shan+Zheng&family=ZCOOL+QingKe+HuangYou&family=ZCOOL+XiaoWei&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Serif SC', serif;
            background: #0a0e17;
            color: #e6edf3;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* 深邃星空背景 */
        .stellar-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -4;
            background:
                radial-gradient(circle at 20% 30%, rgba(74, 107, 230, 0.08) 0%, transparent 60%),
                radial-gradient(circle at 80% 70%, rgba(255, 87, 127, 0.05) 0%, transparent 60%),
                radial-gradient(circle at 40% 80%, rgba(255, 195, 0, 0.03) 0%, transparent 60%),
                linear-gradient(180deg, #0a0e17 0%, #13182c 100%);
        }

        /* 动态星座效果 */
        .constellation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -3;
        }

        .star-dot {
            position: absolute;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.3); }
        }

        /* 精致雪花背景 */
        .snow-globe {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -2;
        }

        .snow-crystal {
            position: absolute;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.8));
            border-radius: 50%;
            filter: blur(0.3px) drop-shadow(0 0 3px rgba(255, 255, 255, 0.7));
            animation: snowDrift linear infinite;
        }

        @keyframes snowDrift {
            0% {
                transform: translateY(-10px) rotate(0deg);
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
            }
        }

        /* ==================== 精美字幕背景 - 高级渐入渐出版 ==================== */
        .blessings-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0 !important; /* 改为0确保显示 */
            opacity: 0.9 !important; /* 增加不透明度 */
            display: block !important; /* 确保显示 */
        }

        .blessing-word {
            position: absolute;
            font-weight: bold;
            text-shadow:
                0 0 15px currentColor,
                0 0 30px currentColor,
                0 0 45px currentColor;
            animation: gracefulFloat 45s ease-in-out infinite;
            white-space: nowrap;
            opacity: 0;
            will-change: transform, opacity;
            z-index: 1; /* 改为1确保显示 */
            filter: drop-shadow(0 0 10px currentColor); /* 增强光晕 */
        }

        @keyframes gracefulFloat {
            0% {
                transform: translateY(110vh) translateX(-50px) rotate(0deg) scale(0.8);
                opacity: 0;
            }
            10% {
                opacity: 0.4;
            }
            15% {
                opacity: 0.7;
                transform: translateY(85vh) translateX(-25px) rotate(20deg) scale(0.9);
            }
            35% {
                opacity: 0.9;
                transform: translateY(60vh) translateX(0) rotate(40deg) scale(1);
            }
            50% {
                opacity: 1;
                transform: translateY(35vh) translateX(25px) rotate(60deg) scale(1.1);
            }
            65% {
                opacity: 0.8;
                transform: translateY(10vh) translateX(50px) rotate(80deg) scale(1);
            }
            85% {
                opacity: 0.4;
                transform: translateY(-15vh) translateX(75px) rotate(100deg) scale(0.9);
            }
            95% {
                opacity: 0.2;
            }
            100% {
                transform: translateY(-40vh) translateX(100px) rotate(120deg) scale(0.8);
                opacity: 0;
            }
        }

        /* ==================== 绚丽大烟花容器 ==================== */
        .spectacular-fireworks {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .firework-burst {
            position: absolute;
            border-radius: 50%;
            animation: bigExplode 2.5s ease-out forwards;
            filter: blur(1px);
        }

        .firework-particle {
            position: absolute;
            border-radius: 50%;
            animation: particleTrail 2s ease-out forwards;
            filter: blur(0.5px);
        }

        @keyframes bigExplode {
            0% {
                transform: scale(0);
                opacity: 1;
                box-shadow:
                    0 0 0 0 rgba(255, 255, 255, 0.8),
                    0 0 0 0 currentColor;
            }
            30% {
                transform: scale(1.2);
                opacity: 0.9;
                box-shadow:
                    0 0 60px 30px rgba(255, 255, 255, 0.6),
                    0 0 120px 60px currentColor;
            }
            60% {
                transform: scale(1.5);
                opacity: 0.7;
                box-shadow:
                    0 0 80px 40px rgba(255, 255, 255, 0.4),
                    0 0 160px 80px currentColor;
            }
            100% {
                transform: scale(2);
                opacity: 0;
                box-shadow:
                    0 0 100px 50px transparent,
                    0 0 200px 100px transparent;
            }
        }

        @keyframes particleTrail {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) scale(0);
                opacity: 0;
            }
        }

        /* 主容器 */
        .elegant-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 60px 40px;
            position: relative;
            z-index: 10;
        }

        /* 高级标题设计 */
        .header-masterpiece {
            text-align: center;
            margin-bottom: 60px;
            position: relative;
        }

        .title-glow {
            position: relative;
            display: inline-block;
            padding: 0 60px;
        }

        .title-glow::before,
        .title-glow::after {
            content: '✦';
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.8rem;
            color: #4a6be6;
            opacity: 0.7;
            animation: spin 20s linear infinite;
        }

        .title-glow::before {
            left: 0;
        }

        .title-glow::after {
            right: 0;
        }

        @keyframes spin {
            0% { transform: translateY(-50%) rotate(0deg); }
            100% { transform: translateY(-50%) rotate(360deg); }
        }

        .master-title {
            font-size: 4rem;
            font-weight: 300;
            letter-spacing: 6px;
            background: linear-gradient(45deg,
                #ffffff 30%,
                #4a6be6 50%,
                #ff577f 70%
            );
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 20px;
            text-shadow:
                0 0 25px rgba(74, 107, 230, 0.4),
                0 0 50px rgba(255, 87, 127, 0.3);
        }

        .master-subtitle {
            font-size: 1.2rem;
            color: rgba(230, 237, 243, 0.7);
            margin-top: 20px;
            font-weight: 300;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        /* 年份选择 - 简化 */
        .year-navigation {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 30px auto;
            flex-wrap: wrap;
            max-width: 800px;
            opacity: 0.8;
        }

        .year-chip {
            padding: 10px 22px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            color: rgba(230, 237, 243, 0.7);
            font-weight: 300;
        }

        .year-chip:hover {
            background: rgba(74, 107, 230, 0.12);
            border-color: rgba(74, 107, 230, 0.3);
            transform: translateY(-2px);
        }

        .year-chip.active {
            background: rgba(74, 107, 230, 0.2);
            border-color: #4a6be6;
            color: #ffffff;
            box-shadow: 0 0 15px rgba(74, 107, 230, 0.3);
        }

        /* 倒计时艺术 */
        .countdown-art {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 30px;
            padding: 50px 40px;
            margin: 50px auto;
            max-width: 900px;
            border: 1px solid rgba(255, 255, 255, 0.06);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .countdown-art::before {
            content: '';
            position: absolute;
            top: -1px;
            left: -1px;
            right: -1px;
            bottom: -1px;
            background: conic-gradient(
                from 0deg,
                transparent,
                rgba(74, 107, 230, 0.2),
                rgba(255, 87, 127, 0.2),
                rgba(255, 195, 0, 0.2),
                transparent
            );
            border-radius: 31px;
            z-index: -1;
            animation: rotateConic 12s linear infinite;
        }

        @keyframes rotateConic {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .countdown-art::after {
            content: '';
            position: absolute;
            top: 1px;
            left: 1px;
            right: 1px;
            bottom: 1px;
            background: #0a0e17;
            border-radius: 29px;
            z-index: -1;
        }

        .countdown-headline {
            text-align: center;
            font-size: 1.6rem;
            color: #ffffff;
            margin-bottom: 40px;
            font-weight: 300;
        }

        .countdown-headline span {
            background: linear-gradient(45deg, #4a6be6, #ff577f);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 500;
        }

        .countdown-grid-art {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }

        @media (max-width: 768px) {
            .countdown-grid-art {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .time-art-block {
            text-align: center;
            padding: 35px 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 20px;
            transition: all 0.3s;
        }

        .time-art-block:hover {
            background: rgba(255, 255, 255, 0.06);
            transform: translateY(-5px);
        }

        .time-art-value {
            font-family: 'ZCOOL QingKe HuangYou', cursive;
            font-size: 3rem;
            font-weight: 400;
            background: linear-gradient(45deg,
                #ffffff 20%,
                #4a6be6 50%,
                #ff577f 80%
            );
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
        }

        .time-art-label {
            font-size: 0.95rem;
            color: rgba(230, 237, 243, 0.6);
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        /* 内容区 */
        .content-masterpiece {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 35px;
            margin: 50px 0;
        }

        @media (max-width: 1200px) {
            .content-masterpiece {
                grid-template-columns: 1fr;
                gap: 30px;
            }
        }

        /* 发布区 */
        .compose-masterpiece {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 25px;
            padding: 35px 30px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px);
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 18px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #4a6be6, #ff577f);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            color: white;
        }

        .section-title {
            font-size: 1.6rem;
            color: #ffffff;
            font-weight: 400;
        }

        .form-art-group {
            margin-bottom: 25px;
        }

        .form-art-label {
            display: block;
            margin-bottom: 10px;
            color: rgba(230, 237, 243, 0.7);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1.2px;
        }

        .input-art-field {
            width: 100%;
            padding: 16px 22px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #ffffff;
            font-size: 1rem;
            font-family: 'Noto Serif SC', serif;
            transition: all 0.3s;
        }

        .input-art-field:focus {
            outline: none;
            border-color: #4a6be6;
            box-shadow: 0 0 0 2px rgba(74, 107, 230, 0.2);
            background: rgba(255, 255, 255, 0.05);
        }

        .input-art-field::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }

        textarea.input-art-field {
            min-height: 160px;
            resize: vertical;
            line-height: 1.6;
        }

        /* 上传区 */
        .upload-art {
            border: 2px dashed rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 40px 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.01);
        }

        .upload-art:hover {
            border-color: #4a6be6;
            background: rgba(74, 107, 230, 0.05);
        }

        .upload-art-icon {
            font-size: 2.8rem;
            color: rgba(255, 255, 255, 0.3);
            margin-bottom: 15px;
            transition: color 0.3s;
        }

        .upload-art:hover .upload-art-icon {
            color: #4a6be6;
        }

        .upload-art-text {
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .upload-art-note {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.4);
        }

        .preview-art {
            margin-top: 20px;
            display: none;
        }

        .preview-art-img {
            max-width: 100%;
            max-height: 220px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* 祝福墙 */
        .wishes-masterpiece {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 25px;
            padding: 35px 30px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px);
            max-height: 750px;
            display: flex;
            flex-direction: column;
        }

        .wall-header-art {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .wall-stats-art {
            background: rgba(74, 107, 230, 0.15);
            padding: 8px 20px;
            border-radius: 18px;
            color: #4a6be6;
            font-size: 0.85rem;
        }

        .wishes-scroll-art {
            flex: 1;
            overflow-y: auto;
            padding-right: 12px;
        }

        .wishes-scroll-art::-webkit-scrollbar {
            width: 6px;
        }

        .wishes-scroll-art::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 3px;
        }

        .wishes-scroll-art::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #4a6be6, #ff577f);
            border-radius: 3px;
        }

        /* 祝福卡片 */
        .wish-card-art {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 20px;
            padding: 30px 25px;
            margin-bottom: 20px;
            border-left: 3px solid #4a6be6;
            animation: cardReveal 0.5s ease-out;
            transition: all 0.3s;
            position: relative;
        }

        @keyframes cardReveal {
            from {
                opacity: 0;
                transform: translateY(15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .wish-card-art:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateY(-3px);
        }

        .wish-header-art {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
        }

        .wish-author-art {
            font-size: 1.1rem;
            color: #ffffff;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .author-avatar-art {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #4a6be6, #ff577f);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .wish-time-art {
            font-size: 0.85rem;
            color: rgba(230, 237, 243, 0.6);
            background: rgba(255, 255, 255, 0.05);
            padding: 6px 15px;
            border-radius: 15px;
        }

        .wish-content-art {
            font-size: 1.05rem;
            line-height: 1.6;
            color: rgba(230, 237, 243, 0.9);
            margin-bottom: 20px;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .wish-media-art {
            max-width: 100%;
            max-height: 260px;
            border-radius: 12px;
            margin-top: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .wish-media-art:hover {
            transform: scale(1.02);
        }

        /* 删除按钮 */
        .delete-wish-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 87, 127, 0.1);
            border: 1px solid rgba(255, 87, 127, 0.3);
            color: #ff577f;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            opacity: 0;
        }

        .wish-card-art:hover .delete-wish-btn {
            opacity: 1;
        }

        .delete-wish-btn:hover {
            background: rgba(255, 87, 127, 0.2);
            transform: scale(1.1);
        }

        .empty-art-state {
            text-align: center;
            padding: 60px 20px;
            color: rgba(255, 255, 255, 0.3);
        }

        .empty-art-icon {
            font-size: 3.5rem;
            margin-bottom: 25px;
            opacity: 0.2;
        }

        /* 按钮 */
        .btn-art {
            padding: 16px 30px;
            border: none;
            border-radius: 12px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 5px;
            font-family: 'Noto Serif SC', serif;
        }

        .btn-art-primary {
            background: linear-gradient(135deg, #4a6be6, #ff577f);
            color: #ffffff;
        }

        .btn-art-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(74, 107, 230, 0.3);
        }

        .btn-art-secondary {
            background: rgba(255, 255, 255, 0.07);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.12);
        }

        .btn-art-secondary:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-3px);
        }

        .btn-art-active {
            background: rgba(74, 107, 230, 0.3);
            border: 1px solid #4a6be6;
            color: #ffffff;
            box-shadow: 0 0 15px rgba(74, 107, 230, 0.3);
        }

        .action-art-group {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        /* 控制栏 */
        .control-art-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
            flex-wrap: wrap;
        }

        /* 音乐控制 */
        .audio-art-station {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 20px;
            padding: 30px 25px;
            margin-top: 40px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .audio-art-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .audio-art-title {
            font-size: 1.2rem;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .audio-art-info {
            color: rgba(230, 237, 243, 0.6);
            background: rgba(255, 255, 255, 0.05);
            padding: 10px 20px;
            border-radius: 18px;
            min-width: 180px;
            text-align: center;
        }

        .audio-art-controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        /* 特效控制面板 - 缩小版 */
        .effects-control-panel {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 20px;
            padding: 25px 20px;
            margin: 30px auto;
            max-width: 800px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px);
        }

        .effects-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .effects-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #00CEC9, #4A6BE6);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
        }

        .effects-title {
            font-size: 1.4rem;
            color: #ffffff;
            font-weight: 400;
        }

        .effects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .effect-control-group {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.06);
        }

        .effect-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: #ffffff;
            font-size: 1rem;
        }

        .effect-icon {
            width: 35px;
            height: 35px;
            background: rgba(74, 107, 230, 0.15);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4a6be6;
            font-size: 0.9rem;
        }

        .slider-container {
            margin: 15px 0;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: rgba(230, 237, 243, 0.7);
            font-size: 0.85rem;
        }

        .slider {
            width: 100%;
            height: 5px;
            -webkit-appearance: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4a6be6, #ff577f);
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .toggle-buttons {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .toggle-btn {
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: rgba(230, 237, 243, 0.7);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 0.85rem;
        }

        .toggle-btn.active {
            background: rgba(74, 107, 230, 0.2);
            border-color: #4a6be6;
            color: #ffffff;
        }

        .toggle-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* 分享弹窗 */
        .share-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .share-modal-content {
            background: rgba(26, 32, 44, 0.95);
            border-radius: 20px;
            padding: 30px;
            max-width: 450px;
            width: 90%;
            border: 1px solid rgba(74, 107, 230, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .share-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .share-modal-title {
            font-size: 1.4rem;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-share-modal {
            background: none;
            border: none;
            color: rgba(230, 237, 243, 0.6);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-share-modal:hover {
            color: #ff577f;
        }

        .share-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
        }

        .share-option {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .share-option:hover {
            background: rgba(74, 107, 230, 0.1);
            transform: translateY(-2px);
        }

        .share-option-icon {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #4a6be6, #ff577f);
            border-radius: 10px;
            display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 1.2rem;
            }

            .share-option-text h4 {
                color: #ffffff;
                margin-bottom: 5px;
            }

            .share-option-text p {
                color: rgba(230, 237, 243, 0.6);
                font-size: 0.9rem;
            }

            .share-link-container {
                display: flex;
                gap: 10px;
                margin-top: 20px;
            }

            .share-link-input {
                flex: 1;
                padding: 12px 15px;
                background: rgba(255, 255, 255, 0.05);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 8px;
                color: #ffffff;
                font-size: 0.9rem;
                font-family: 'Noto Serif SC', serif;
            }

            .copy-link-btn {
                padding: 12px 20px;
                background: rgba(74, 107, 230, 0.2);
                border: 1px solid rgba(74, 107, 230, 0.4);
                border-radius: 8px;
                color: #4a6be6;
                cursor: pointer;
                transition: all 0.3s;
            }

            .copy-link-btn:hover {
                background: rgba(74, 107, 230, 0.3);
            }

            /* 提示消息 */
            .toast-notification {
                position: fixed;
                top: 30px;
                right: 30px;
                background: rgba(74, 107, 230, 0.9);
                backdrop-filter: blur(10px);
                color: white;
                padding: 18px 25px;
                border-radius: 12px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                z-index: 1000;
                transform: translateX(400px);
                transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
                max-width: 350px;
                display: flex;
                align-items: center;
                gap: 15px;
            }

            .toast-notification.show {
                transform: translateX(0);
            }

            .toast-icon {
                font-size: 1.4rem;
                color: #ffffff;
            }

            .toast-content {
                flex: 1;
            }

            .toast-title {
                font-weight: 600;
                margin-bottom: 5px;
            }

            .toast-message {
                font-size: 0.9rem;
                opacity: 0.9;
            }

            /* 响应式 */
            @media (max-width: 1200px) {
                .master-title {
                    font-size: 3.2rem;
                }

                .content-masterpiece {
                    gap: 25px;
                }

                .compose-masterpiece,
                .wishes-masterpiece {
                    padding: 30px 25px;
                }

                .effects-grid {
                    grid-template-columns: 1fr;
                }
            }

            @media (max-width: 768px) {
                .elegant-container {
                    padding: 30px 20px;
                }

                .master-title {
                    font-size: 2.5rem;
                    letter-spacing: 3px;
                }

                .year-navigation {
                    gap: 8px;
                }

                .year-chip {
                    padding: 8px 18px;
                    font-size: 0.95rem;
                }

                .time-art-value {
                    font-size: 2.2rem;
                }

                .action-art-group {
                    flex-direction: column;
                }

                .control-art-bar {
                    gap: 12px;
                }

                .toast-notification {
                    left: 20px;
                    right: 20px;
                    max-width: none;
                }

                .effects-control-panel {
                    padding: 20px 15px;
                }

                .effects-grid {
                    gap: 15px;
                }
            }
        </style>
    </head>
    <body>
        <!-- 背景层 -->
        <div class="stellar-bg"></div>
        <div class="constellation" id="constellation"></div>
        <div class="snow-globe" id="snowGlobe"></div>
        <div class="blessings-canvas" id="blessingsCanvas"></div>
        <div class="spectacular-fireworks" id="fireworksDisplay"></div>

        <!-- 分享弹窗 -->
        <div class="share-modal" id="shareModal">
            <div class="share-modal-content">
                <div class="share-modal-header">
                    <h3 class="share-modal-title"><i class="fas fa-share-nodes"></i> 分享祝福墙</h3>
                    <button class="close-share-modal" id="closeShareModal">&times;</button>
                </div>
                <div class="share-options">
                    <div class="share-option" id="copyLinkOption">
                        <div class="share-option-icon">
                            <i class="fas fa-link"></i>
                        </div>
                        <div class="share-option-text">
                            <h4>复制链接</h4>
                            <p>复制网址链接分享给朋友</p>
                        </div>
                    </div>
                    <div class="share-option" id="shareWebOption">
                        <div class="share-option-icon">
                            <i class="fas fa-share-alt"></i>
                        </div>
                        <div class="share-option-text">
                            <h4>分享到...</h4>
                            <p>通过社交媒体分享</p>
                        </div>
                    </div>
                </div>
                <div class="share-link-container">
                    <input type="text" class="share-link-input" id="shareLinkInput" readonly value="https://时光祝福墙.com">
                    <button class="copy-link-btn" id="copyLinkBtn">复制</button>
                </div>
            </div>
        </div>

        <!-- 提示消息 -->
        <div class="toast-notification" id="toastNotification">
            <div class="toast-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="toast-content">
                <div class="toast-title" id="toastTitle">发布成功！</div>
                <div class="toast-message" id="toastMessage">您的祝福已添加到时光廊</div>
            </div>
        </div>

        <!-- 主容器 -->
        <div class="elegant-container">
            <!-- 标题区 -->
            <header class="header-masterpiece">
                <div class="title-glow">
                    <h1 class="master-title">
                        时笺祝福
                    </h1>
                </div>
                <div class="master-subtitle">永恒祝福 · 岁月纪念墙</div>
            </header>

            <!-- 简化年份导航 -->
            <div class="year-navigation" id="yearNavigation">
                <!-- 动态生成 -->
            </div>

            <!-- 倒计时 -->
            <div class="countdown-art">
                <h2 class="countdown-headline">迎接 <span id="targetYearDisplay">2026</span> 新岁</h2>
                <div class="countdown-grid-art">
                    <div class="time-art-block">
                        <div class="time-art-value" id="countdownDays">00</div>
                        <div class="time-art-label">DAYS</div>
                    </div>
                    <div class="time-art-block">
                        <div class="time-art-value" id="countdownHours">00</div>
                        <div class="time-art-label">HOURS</div>
                    </div>
                    <div class="time-art-block">
                        <div class="time-art-value" id="countdownMinutes">00</div>
                        <div class="time-art-label">MINUTES</div>
                    </div>
                    <div class="time-art-block">
                        <div class="time-art-value" id="countdownSeconds">00</div>
                        <div class="time-art-label">SECONDS</div>
                    </div>
                </div>
            </div>

            <!-- 内容区 -->
            <div class="content-masterpiece">
                <!-- 发布祝福 -->
                <div class="compose-masterpiece">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-feather-alt"></i>
                        </div>
                        <h2 class="section-title">书写祝福</h2>
                    </div>

                    <div class="form-art-group">
                        <label class="form-art-label">署名</label>
                        <input type="text" class="input-art-field" id="authorInput" placeholder="可留空，默认为时光旅人">
                    </div>

                    <div class="form-art-group">
                        <label class="form-art-label">祝福寄语</label>
                        <textarea class="input-art-field" id="blessingInput" placeholder="写下您对新岁的期许与祝福..."></textarea>
                    </div>

                    <div class="form-art-group">
                        <label class="form-art-label">添加影像</label>
                        <div class="upload-art" id="uploadArt">
                            <i class="fas fa-cloud-upload-alt upload-art-icon"></i>
                            <div class="upload-art-text">点击或拖拽上传图片</div>
                            <div class="upload-art-note">支持 JPG、PNG 格式 · 最大 5MB</div>
                            <input type="file" id="imageUploadInput" accept="image/*" style="display: none;">
                        </div>

                        <div class="preview-art" id="previewArt">
                            <img class="preview-art-img" id="previewArtImg" alt="预览">
                            <div style="text-align: center; margin-top: 15px;">
                                <button class="btn-art btn-art-secondary" id="removePreviewBtn">
                                    <i class="fas fa-trash-alt"></i> 移除影像
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="action-art-group">
                        <button class="btn-art btn-art-primary" id="publishBlessingBtn">
                            <i class="fas fa-paper-plane"></i> 发布祝福
                        </button>
                        <button class="btn-art btn-art-secondary" id="clearInputsBtn">
                            <i class="fas fa-undo"></i> 清空重写
                        </button>
                    </div>
                </div>

                <!-- 祝福墙 -->
                <div class="wishes-masterpiece">
                    <div class="wall-header-art">
                        <h2 class="section-title">祝福时光廊</h2>
                        <div class="wall-stats-art" id="wallStatsArt">0 条祝福</div>
                    </div>

                    <div class="wishes-scroll-art" id="wishesScrollArt">
                        <div class="empty-art-state">
                            <i class="fas fa-scroll empty-art-icon"></i>
                            <h3 style="color: rgba(255, 255, 255, 0.4); margin-bottom: 15px;">时光廊中暂无祝福</h3>
                            <p>成为书写时光的第一人</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 控制栏 - 修改按钮 -->
            <div class="control-art-bar">
                <button class="btn-art btn-art-secondary" id="refreshBlessingsBtn">
                    <i class="fas fa-sync-alt"></i> 刷新祝福
                </button>
                <button class="btn-art btn-art-secondary" id="shareWallBtn">
                    <i class="fas fa-share-nodes"></i> 分享时光
                </button>
                <!-- 将测试字幕按钮改为数据模式切换按钮 -->
                <button class="btn-art btn-art-active" id="dataModeBtn">
                    <i class="fas fa-database"></i> 云端模式
                </button>
            </div>

            <!-- 音乐控制 -->
            <div class="audio-art-station">
                <div class="audio-art-header">
                    <h3 class="audio-art-title"><i class="fas fa-music"></i> 时光配乐</h3>
                    <div class="audio-art-info" id="audioInfoArt">未选择音乐</div>
                    <div>
                        <input type="file" id="audioFileInput" accept="audio/*" style="display: none;">
                        <button class="btn-art btn-art-secondary" id="selectAudioBtnArt">
                            <i class="fas fa-file-audio"></i> 选择音乐
                        </button>
                    </div>
                </div>

                <div class="audio-art-controls">
                    <button class="btn-art btn-art-secondary" id="playAudioBtn" disabled>
                        <i class="fas fa-play"></i> 播放
                    </button>
                    <button class="btn-art btn-art-secondary" id="pauseAudioBtn" disabled>
                        <i class="fas fa-pause"></i> 暂停
                    </button>
                    <button class="btn-art btn-art-secondary" id="volumeUpBtnArt">
                        <i class="fas fa-volume-up"></i> 音量+
                    </button>
                    <button class="btn-art btn-art-secondary" id="volumeDownBtnArt">
                        <i class="fas fa-volume-down"></i> 音量-
                    </button>
                </div>
            </div>

            <!-- 特效控制面板 -->
            <div class="effects-control-panel">
                <div class="effects-header">
                    <div class="effects-icon">
                        <i class="fas fa-magic"></i>
                    </div>
                    <h2 class="effects-title">特效控制中心</h2>
                </div>

                <div class="effects-grid">
                    <!-- 雪花控制 -->
                    <div class="effect-control-group">
                        <div class="effect-title">
                            <div class="effect-icon">
                                <i class="fas fa-snowflake"></i>
                            </div>
                            <span>雪花特效</span>
                        </div>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>雪花密度</span>
                                <span id="snowDensityValue">60%</span>
                            </div>
                            <input type="range" class="slider" id="snowDensitySlider" min="0" max="100" value="60">
                        </div>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>雪花速度</span>
                                <span id="snowSpeedValue">中速</span>
                            </div>
                            <input type="range" class="slider" id="snowSpeedSlider" min="1" max="10" value="5">
                        </div>
                        <div class="toggle-buttons">
                            <div class="toggle-btn active" id="snowOnBtn">
                                <i class="fas fa-play"></i> 开启
                            </div>
                            <div class="toggle-btn" id="snowOffBtn">
                                <i class="fas fa-stop"></i> 关闭
                            </div>
                        </div>
                    </div>

                    <!-- 烟花控制 -->
                    <div class="effect-control-group">
                        <div class="effect-title">
                            <div class="effect-icon">
                                <i class="fas fa-fire"></i>
                            </div>
                            <span>烟花特效</span>
                        </div>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>烟花频率</span>
                                <span id="fireworksFreqValue">中等</span>
                            </div>
                            <input type="range" class="slider" id="fireworksFreqSlider" min="1" max="10" value="5">
                        </div>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>烟花大小</span>
                                <span id="fireworksSizeValue">中等</span>
                            </div>
                            <input type="range" class="slider" id="fireworksSizeSlider" min="1" max="10" value="5">
                        </div>
                        <div class="toggle-buttons">
                            <div class="toggle-btn active" id="fireworksOnBtn">
                                <i class="fas fa-play"></i> 开启
                            </div>
                            <div class="toggle-btn" id="fireworksOffBtn">
                                <i class="fas fa-stop"></i> 关闭
                            </div>
                            <div class="toggle-btn" id="fireworksBurstBtn">
                                <i class="fas fa-bolt"></i> 绽放
                            </div>
                        </div>
                    </div>

                    <!-- 字幕控制 -->
                    <div class="effect-control-group">
                        <div class="effect-title">
                            <div class="effect-icon">
                                <i class="fas fa-font"></i>
                            </div>
                            <span>祝福字幕</span>
                        </div>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>字幕密度</span>
                                <span id="wordsDensityValue">60%</span>
                            </div>
                            <input type="range" class="slider" id="wordsDensitySlider" min="0" max="100" value="60">
                        </div>
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>字幕速度</span>
                                <span id="wordsSpeedValue">中速</span>
                            </div>
                            <input type="range" class="slider" id="wordsSpeedSlider" min="20" max="100" value="40">
                        </div>
                        <div class="toggle-buttons">
                            <div class="toggle-btn active" id="wordsOnBtn">
                                <i class="fas fa-eye"></i> 显示
                            </div>
                            <div class="toggle-btn" id="wordsOffBtn">
                                <i class="fas fa-eye-slash"></i> 隐藏
                            </div>
                            <div class="toggle-btn" id="refreshWordsBtn">
                                <i class="fas fa-sync"></i> 刷新
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 音频 -->
        <audio id="backgroundAudioPlayer"></audio>

        <script>
            // ================================
            // 配置与常量 - 使用正确的旧版API密钥
            // ================================
            const SUPABASE_CONFIG = {
                url: 'https://nykvaietmikknpwuyrdk.supabase.co',
                anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im55a3ZhaWV0bWlra25wd3V5cmRrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxODE2ODYsImV4cCI6MjA4MDc1NzY4Nn0.FTN4mXzPJ7FfYsWQL3KQZ5YX_rvKvGWmm_m1kpe2OT0'
            };

            // 祝福内容
            const blessingWords = [
                "福", "囍", "吉", "祥", "春", "樂", "安", "康", "和", "順",
                "發", "財", "新", "年", "快", "樂", "萬", "事", "如", "意"
            ];

            const blessingPhrases = [
                "新年快乐", "万事如意", "身体健康", "阖家幸福", "恭喜发财",
                "心想事成", "岁岁平安", "年年有余", "笑口常开", "好运连连"
            ];

            // 高级颜色数组
            const premiumColors = [
                'rgba(255, 215, 0, 0.6)',
                'rgba(255, 107, 107, 0.5)',
                'rgba(78, 205, 196, 0.6)',
                'rgba(162, 155, 254, 0.5)',
                'rgba(255, 195, 0, 0.6)',
                'rgba(255, 255, 255, 0.7)',
                'rgba(255, 159, 243, 0.5)',
                'rgba(129, 236, 236, 0.6)',
                'rgba(253, 203, 110, 0.6)',
                'rgba(85, 239, 196, 0.6)'
            ];

            // 字体数组
            const fontFamilies = [
                "'Ma Shan Zheng', cursive",
                "'Noto Serif SC', serif",
                "'ZCOOL XiaoWei', serif",
                "'ZCOOL QingKe HuangYou', cursive",
                "'Georgia', serif",
                "'Times New Roman', serif"
            ];

            // 全局变量
            let currentYear = 2026;
            let wishes = [];
            let snowInterval;
            let fireworksInterval;
            let currentSnowCount = 60;
            let snowEnabled = true;
            let fireworksEnabled = true;
            let wordsEnabled = true;
            let currentFireworksFrequency = 5;
            let currentWordsDensity = 60;
            let dataMode = 'supabase'; // 'local' 或 'supabase'

            // ================================
            // 工具函数
            // ================================

            // 显示提示消息
            function showToast(title, message, type = 'success') {
                const toast = document.getElementById('toastNotification');
                const toastTitle = document.getElementById('toastTitle');
                const toastMessage = document.getElementById('toastMessage');
                const toastIcon = toast.querySelector('.toast-icon i');

                toastTitle.textContent = title;
                toastMessage.textContent = message;

                if (type === 'success') {
                    toast.style.background = 'rgba(74, 107, 230, 0.9)';
                    toastIcon.className = 'fas fa-check-circle';
                } else if (type === 'error') {
                    toast.style.background = 'rgba(255, 87, 127, 0.9)';
                    toastIcon.className = 'fas fa-exclamation-circle';
                } else if (type === 'info') {
                    toast.style.background = 'rgba(0, 206, 201, 0.9)';
                    toastIcon.className = 'fas fa-info-circle';
                }

                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }

            // 格式化时间
            function formatTime(date) {
                const now = new Date();
                const diff = now - date;

                if (diff < 60000) return '刚刚';
                if (diff < 3600000) return `${Math.floor(diff / 60000)}分钟前`;
                if (diff < 86400000) return `${Math.floor(diff / 3600000)}小时前`;
                if (diff < 604800000) return `${Math.floor(diff / 86400000)}天前`;

                return date.toLocaleDateString('zh-CN', {
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }

            // ================================
            // 字幕系统 - 简化初始化（移除黄色福字）
            // ================================
            function initializeSubtitles() {
                console.log('=== 初始化字幕系统 ===');

                // 确保容器存在
                let canvas = document.getElementById('blessingsCanvas');
                if (!canvas) {
                    console.log('创建字幕容器...');
                    canvas = document.createElement('div');
                    canvas.id = 'blessingsCanvas';
                    canvas.className = 'blessings-canvas';
                    document.body.appendChild(canvas);
                }

                // 强制设置样式
                canvas.style.cssText = `
                    position: fixed !important;
                    top: 0 !important;
                    left: 0 !important;
                    width: 100vw !important;
                    height: 100vh !important;
                    display: block !important;
                    opacity: 0.9 !important;
                    z-index: 0 !important;
                    pointer-events: none !important;
                    background: transparent !important;
                    overflow: visible !important;
                `;

                // 直接创建正常的字幕，不再添加测试福字
                createBlessingsCanvas();
                console.log('字幕系统创建完成');
            }

            function createBlessingsCanvas() {
                if (!wordsEnabled) return;

                const container = document.getElementById('blessingsCanvas');
                if (!container) return;

                container.innerHTML = '';

                // 根据密度调整数量
                const wordCount = Math.floor((currentWordsDensity / 100) * 20);
                const phraseCount = Math.floor((currentWordsDensity / 100) * 5);

                // 创建单个祝福汉字
                for (let i = 0; i < wordCount; i++) {
                    createBlessingCharacter(i, container);
                }

                // 创建祝福短语
                for (let i = 0; i < phraseCount; i++) {
                    createBlessingPhrase(i, container);
                }
            }

            function createBlessingCharacter(index, container) {
                const char = document.createElement('div');
                char.className = 'blessing-word';

                const character = blessingWords[Math.floor(Math.random() * blessingWords.length)];
                char.textContent = character;

                const fontFamily = fontFamilies[Math.floor(Math.random() * fontFamilies.length)];
                char.style.fontFamily = fontFamily;

                const fontSize = 55 + Math.random() * 35;
                char.style.fontSize = `${fontSize}px`;

                const useGradient = Math.random() > 0.5;
                if (useGradient) {
                    char.style.background = 'linear-gradient(45deg, rgba(255,215,0,0.7), rgba(255,195,0,0.5))';
                    char.style.webkitBackgroundClip = 'text';
                    char.style.backgroundClip = 'text';
                    char.style.color = 'transparent';
                } else {
                    const color = premiumColors[Math.floor(Math.random() * premiumColors.length)];
                    char.style.color = color;
                }

                const startX = Math.random() * 90;
                const startY = 100 + Math.random() * 25;
                char.style.left = `${startX}vw`;
                char.style.top = `${startY}vh`;

                const duration = 30 + Math.random() * 30;
                const delay = Math.random() * 20;

                char.style.animationDuration = `${duration}s`;
                char.style.animationDelay = `${delay}s`;

                const currentColor = window.getComputedStyle(char).color;
                char.style.textShadow = `0 0 15px ${currentColor}, 0 0 30px ${currentColor}`;
                char.style.fontWeight = Math.random() > 0.5 ? '400' : '600';

                container.appendChild(char);
            }

            function createBlessingPhrase(index, container) {
                const phrase = document.createElement('div');
                phrase.className = 'blessing-word';

                const text = blessingPhrases[Math.floor(Math.random() * blessingPhrases.length)];
                phrase.textContent = text;

                const fontFamily = fontFamilies[Math.floor(Math.random() * fontFamilies.length)];
                phrase.style.fontFamily = fontFamily;

                const fontSize = 30 + Math.random() * 20;
                phrase.style.fontSize = `${fontSize}px`;

                phrase.style.background = 'linear-gradient(45deg, rgba(255,107,107,0.6), rgba(255,159,243,0.4))';
                phrase.style.webkitBackgroundClip = 'text';
                phrase.style.backgroundClip = 'text';
                phrase.style.color = 'transparent';

                const startX = Math.random() * 85;
                const startY = 95 + Math.random() * 30;
                phrase.style.left = `${startX}vw`;
                phrase.style.top = `${startY}vh`;

                const duration = 35 + Math.random() * 35;
                const delay = Math.random() * 25;

                phrase.style.animationDuration = `${duration}s`;
                phrase.style.animationDelay = `${delay}s`;

                phrase.style.textShadow = '0 0 20px currentColor, 0 0 40px currentColor';
                phrase.style.fontWeight = '500';
                phrase.style.letterSpacing = '1px';

                container.appendChild(phrase);
            }

            // 控制字幕
            function toggleWords(enabled) {
                wordsEnabled = enabled;
                const canvas = document.getElementById('blessingsCanvas');

                if (enabled) {
                    createBlessingsCanvas();
                    canvas.style.display = 'block';
                    showToast('祝福字幕', '祝福字幕已显示', 'info');
                } else {
                    canvas.innerHTML = '';
                    canvas.style.display = 'none';
                    showToast('祝福字幕', '祝福字幕已隐藏', 'info');
                }

                updateToggleButtons('words', enabled);
            }

            // 更新字幕密度
            function updateWordsDensity(value) {
                currentWordsDensity = value;
                document.getElementById('wordsDensityValue').textContent = `${value}%`;
                if (wordsEnabled) createBlessingsCanvas();
            }

            // 更新字幕速度
            function updateWordsSpeed(value) {
                const speedText = value < 30 ? '慢速' : value < 60 ? '中速' : '快速';
                document.getElementById('wordsSpeedValue').textContent = speedText;
                if (wordsEnabled) createBlessingsCanvas();
            }

            // ================================
            // Supabase 数据库操作
            // ================================

            // 创建Supabase客户端
            function createSupabaseClient() {
                console.log('使用旧版API密钥创建Supabase客户端...');

                try {
                    const client = supabase.createClient(
                        SUPABASE_CONFIG.url,
                        SUPABASE_CONFIG.anonKey,
                        {
                            auth: {
                                persistSession: false,
                                autoRefreshToken: false
                            }
                        }
                    );

                    console.log('Supabase客户端创建成功');
                    return client;
                } catch (error) {
                    console.error('创建客户端失败:', error);
                    return null;
                }
            }

            // 获取设备信息
            function getDeviceInfo() {
                const ua = navigator.userAgent;
                return {
                    browser: ua.match(/(chrome|firefox|safari|opera|edge)\/?\s*(\d+)/i) ? ua.match(/(chrome|firefox|safari|opera|edge)\/?\s*(\d+)/i)[1] : 'unknown',
                    platform: navigator.platform,
                    language: navigator.language,
                    userAgent: ua.substring(0, 200)
                };
            }

            // 测试Supabase连接
            async function testSupabaseConnection() {
                console.log('测试Supabase连接...');

                const supabase = createSupabaseClient();

                try {
                    const { data, error } = await supabase
                        .from('wishes')
                        .select('count')
                        .limit(1);

                    if (error) {
                        console.error('查询错误:', error);
                        return false;
                    } else {
                        console.log('连接成功! 数据:', data);
                        return true;
                    }
                } catch (error) {
                    console.error('连接测试异常:', error);
                    return false;
                }
            }

            // ================================
            // 数据存储模式切换功能
            // ================================

            // 切换数据模式
            function toggleDataMode() {
                if (dataMode === 'supabase') {
                    dataMode = 'local';
                    document.getElementById('dataModeBtn').innerHTML = '<i class="fas fa-hdd"></i> 本地模式';
                    document.getElementById('dataModeBtn').classList.remove('btn-art-active');
                    document.getElementById('dataModeBtn').classList.add('btn-art-secondary');
                    showToast('切换模式', '已切换到本地存储模式', 'info');
                } else {
                    dataMode = 'supabase';
                    document.getElementById('dataModeBtn').innerHTML = '<i class="fas fa-database"></i> 云端模式';
                    document.getElementById('dataModeBtn').classList.remove('btn-art-secondary');
                    document.getElementById('dataModeBtn').classList.add('btn-art-active');
                    showToast('切换模式', '已切换到云端数据库模式', 'success');
                }

                // 重新加载数据
                loadWishes();
            }

            // 发布祝福（根据模式选择存储方式）
            async function publishBlessingToDatabase(blessingData) {
                if (dataMode === 'supabase') {
                    return await publishToSupabase(blessingData);
                } else {
                    return publishToLocalStorage(blessingData);
                }
            }

            // 发布到Supabase数据库
            async function publishToSupabase(blessingData) {
                try {
                    const supabase = createSupabaseClient();

                    const wishData = {
                        author: blessingData.author || '时光旅人',
                        content: blessingData.content,
                        year: currentYear,
                        timestamp: Date.now(),
                        created_at: new Date().toISOString(),
                        device_info: JSON.stringify(getDeviceInfo()),
                        ip_address: '',
                        date: new Date().toLocaleDateString('zh-CN'),
                        time: new Date().toLocaleTimeString('zh-CN'),
                        detailed_time: new Date().toISOString()
                    };

                    if (blessingData.image) {
                        wishData.image_url = blessingData.image;
                        wishData.has_image = true;
                        wishData.image_name = `image_${Date.now()}.jpg`;
                    }

                    const { data, error } = await supabase
                        .from('wishes')
                        .insert([wishData])
                        .select();

                    if (error) throw error;

                    showToast('发布成功', '您的祝福已添加到云端时光廊', 'success');
                    return data;
                } catch (error) {
                    console.error('发布到云端失败:', error);
                    showToast('云端发布失败', '已自动保存到本地存储', 'error');

                    // 如果云端失败，自动保存到本地
                    return publishToLocalStorage(blessingData);
                }
            }

            // 发布到本地存储
            function publishToLocalStorage(blessingData) {
                try {
                    const localWishes = JSON.parse(localStorage.getItem('newYearWishes') || '[]');
                    const newWish = {
                        id: Date.now(),
                        author: blessingData.author || '时光旅人',
                        content: blessingData.content,
                        year: currentYear,
                        timestamp: new Date(),
                        image: blessingData.image || null,
                        time: '刚刚'
                    };

                    localWishes.unshift(newWish);
                    localStorage.setItem('newYearWishes', JSON.stringify(localWishes.slice(0, 100)));

                    showToast('保存成功', '您的祝福已保存到本地时光廊', 'info');

                    // 返回模拟的数据结构
                    return [newWish];
                } catch (error) {
                    console.error('本地保存失败:', error);
                    showToast('保存失败', '请稍后重试', 'error');
                    return null;
                }
            }

            // 加载祝福（根据模式选择加载方式）
            async function loadWishes() {
                if (dataMode === 'supabase') {
                    await loadFromSupabase();
                } else {
                    loadFromLocalStorage();
                }
            }

            // 从Supabase加载祝福
            async function loadFromSupabase() {
                try {
                    const supabase = createSupabaseClient();

                    const { data, error } = await supabase
                        .from('wishes')
                        .select('*')
                        .eq('year', currentYear)
                        .order('created_at', { ascending: false });

                    if (error) throw error;

                    wishes = data.map(item => ({
                        id: item.id,
                        author: item.author,
                        content: item.content,
                        timestamp: new Date(item.created_at),
                        image: item.image_url,
                        year: item.year,
                        time: item.time || formatTime(new Date(item.created_at))
                    }));

                    updateWishesWall();
                    return wishes;
                } catch (error) {
                    console.error('从云端加载失败:', error);
                    showToast('云端加载失败', '切换到本地数据', 'error');

                    // 云端失败，切换到本地模式
                    dataMode = 'local';
                    document.getElementById('dataModeBtn').innerHTML = '<i class="fas fa-hdd"></i> 本地模式';
                    document.getElementById('dataModeBtn').classList.remove('btn-art-active');
                    document.getElementById('dataModeBtn').classList.add('btn-art-secondary');

                    loadFromLocalStorage();
                    return wishes;
                }
            }

            // 从本地存储加载祝福
            function loadFromLocalStorage() {
                try {
                    const data = localStorage.getItem('newYearWishes');
                    const localWishes = data ? JSON.parse(data) : [];

                    wishes = localWishes.filter(wish => wish.year === currentYear);
                    updateWishesWall();

                    return wishes;
                } catch (error) {
                    console.error('本地加载失败:', error);
                    wishes = [];
                    updateWishesWall();
                    return wishes;
                }
            }

            // 删除祝福（根据模式选择删除方式）
            async function deleteWishFromDatabase(id) {
                if (dataMode === 'supabase') {
                    return await deleteFromSupabase(id);
                } else {
                    return deleteFromLocalStorage(id);
                }
            }

            // 从Supabase删除祝福
            async function deleteFromSupabase(id) {
                try {
                    const supabase = createSupabaseClient();

                    const { error } = await supabase
                        .from('wishes')
                        .delete()
                        .eq('id', id);

                    if (error) throw error;

                    showToast('删除成功', '祝福已从云端时光廊移除', 'info');
                    return true;
                } catch (error) {
                    console.error('从云端删除失败:', error);
                    showToast('删除失败', '云端操作失败，请重试', 'error');
                    return false;
                }
            }

            // 从本地存储删除祝福
            function deleteFromLocalStorage(id) {
                try {
                    const localWishes = JSON.parse(localStorage.getItem('newYearWishes') || '[]');
                    const filteredWishes = localWishes.filter(wish => wish.id !== id);

                    localStorage.setItem('newYearWishes', JSON.stringify(filteredWishes));

                    showToast('删除成功', '祝福已从本地时光廊移除', 'info');
                    return true;
                } catch (error) {
                    console.error('本地删除失败:', error);
                    showToast('删除失败', '本地操作失败', 'error');
                    return false;
                }
            }

            // ================================
            // 背景特效系统
            // ================================

            // 创建星座效果
            function createConstellation() {
                const container = document.getElementById('constellation');
                container.innerHTML = '';

                for (let i = 0; i < 80; i++) {
                    const star = document.createElement('div');
                    star.className = 'star-dot';

                    const size = Math.random() * 1.5 + 0.5;
                    star.style.width = `${size}px`;
                    star.style.height = `${size}px`;
                    star.style.left = `${Math.random() * 100}vw`;
                    star.style.top = `${Math.random() * 100}vh`;
                    star.style.opacity = Math.random() * 0.4 + 0.2;
                    star.style.animationDelay = `${Math.random() * 3}s`;

                    container.appendChild(star);
                }
            }

            // 创建雪花
            function createSnowGlobe() {
                if (!snowEnabled) return;

                const container = document.getElementById('snowGlobe');
                container.innerHTML = '';

                const snowCount = Math.floor((currentSnowCount / 100) * 60);

                for (let i = 0; i < snowCount; i++) {
                    const snowflake = document.createElement('div');
                    snowflake.className = 'snow-crystal';

                    const startX = Math.random() * 100;
                    const startY = Math.random() * -30;
                    const size = i % 3 === 0 ? 3 : i % 3 === 1 ? 4 : 5;
                    const speed = 15 + Math.random() * 15;
                    const duration = speed + (10 - (currentSnowCount / 10));
                    const delay = Math.random() * 10;
                    const opacity = 0.5 + Math.random() * 0.3;

                    snowflake.style.left = `${startX}vw`;
                    snowflake.style.top = `${startY}vh`;
                    snowflake.style.width = `${size}px`;
                    snowflake.style.height = `${size}px`;
                    snowflake.style.opacity = opacity;
                    snowflake.style.animationDuration = `${duration}s`;
                    snowflake.style.animationDelay = `${delay}s`;

                    container.appendChild(snowflake);
                }
            }

            // 控制雪花
            function toggleSnow(enabled) {
                snowEnabled = enabled;
                const snowGlobe = document.getElementById('snowGlobe');

                if (enabled) {
                    createSnowGlobe();
                    snowGlobe.style.display = 'block';
                    showToast('雪花特效', '雪花特效已开启', 'info');
                } else {
                    snowGlobe.innerHTML = '';
                    snowGlobe.style.display = 'none';
                    showToast('雪花特效', '雪花特效已关闭', 'info');
                }

                updateToggleButtons('snow', enabled);
            }

            // 烟花系统
            function setupSpectacularFireworks() {
                if (!fireworksEnabled) return;

                if (fireworksInterval) {
                    clearInterval(fireworksInterval);
                }

                const frequency = 4000 + (currentFireworksFrequency * 500);

                fireworksInterval = setInterval(() => {
                    if (Math.random() > 0.6) {
                        launchBigFirework();
                    }
                }, frequency);

                setTimeout(() => {
                    for (let i = 0; i < 2; i++) {
                        setTimeout(() => launchBigFirework(), i * 500);
                    }
                }, 1500);
            }

            function launchBigFirework() {
                if (!fireworksEnabled) return;

                const container = document.getElementById('fireworksDisplay');
                const colors = ['#FF577F', '#FFC300', '#4A6BE6', '#00CEC9', '#A29BFE'];
                const color1 = colors[Math.floor(Math.random() * colors.length)];
                const color2 = colors[Math.floor(Math.random() * colors.length)];

                const x = Math.random() * window.innerWidth;
                const y = Math.random() * window.innerHeight * 0.7;

                const core = document.createElement('div');
                core.className = 'firework-burst';
                core.style.left = `${x}px`;
                core.style.top = `${y}px`;
                core.style.background = `radial-gradient(circle, ${color1} 0%, ${color2} 100%)`;
                core.style.width = '20px';
                core.style.height = '20px';
                core.style.boxShadow = `0 0 0 0 rgba(255, 255, 255, 0.8)`;

                container.appendChild(core);

                const particleCount = 40 + Math.random() * 30;
                for (let i = 0; i < particleCount; i++) {
                    setTimeout(() => {
                        createBigParticle(x, y, [color1, color2][i % 2]);
                    }, Math.random() * 300);
                }

                setTimeout(() => {
                    if (core.parentNode) {
                        core.parentNode.removeChild(core);
                    }
                }, 2500);
            }

            // ================================
            // 祝福墙功能
            // ================================

            // 发布祝福
            function publishBlessing() {
                const author = document.getElementById('authorInput').value.trim() || '时光旅人';
                const blessing = document.getElementById('blessingInput').value.trim();
                const imageFile = document.getElementById('imageUploadInput').files[0];

                if (!blessing) {
                    showToast('发布失败', '请输入祝福内容', 'error');
                    return;
                }

                if (imageFile) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const newWish = {
                            author: author,
                            content: blessing,
                            image: e.target.result
                        };
                        publishBlessingToDatabase(newWish).then(() => {
                            // 发布后重新加载数据
                            loadWishes();
                        });
                    };
                    reader.readAsDataURL(imageFile);
                } else {
                    const newWish = {
                        author: author,
                        content: blessing
                    };
                    publishBlessingToDatabase(newWish).then(() => {
                        // 发布后重新加载数据
                        loadWishes();
                    });
                }

                // 清空输入
                document.getElementById('authorInput').value = '';
                document.getElementById('blessingInput').value = '';
                document.getElementById('previewArt').style.display = 'none';
                document.getElementById('imageUploadInput').value = '';
            }

            // 更新祝福墙显示
            function updateWishesWall() {
                const container = document.getElementById('wishesScrollArt');
                const stats = document.getElementById('wallStatsArt');

                if (wishes.length === 0) {
                    container.innerHTML = `
                        <div class="empty-art-state">
                            <i class="fas fa-scroll empty-art-icon"></i>
                            <h3 style="color: rgba(255, 255, 255, 0.4); margin-bottom: 15px;">时光廊中暂无祝福</h3>
                            <p>成为书写时光的第一人</p>
                        </div>
                    `;
                    stats.textContent = '0 条祝福';
                    return;
                }

                stats.textContent = `${wishes.length} 条祝福`;

                container.innerHTML = '';
                wishes.forEach(wish => {
                    const wishCard = document.createElement('div');
                    wishCard.className = 'wish-card-art';
                    wishCard.dataset.id = wish.id;

                    let imageHtml = '';
                    if (wish.image) {
                        imageHtml = `<img src="${wish.image}" class="wish-media-art" onclick="viewImage('${wish.image}')">`;
                    }

                    wishCard.innerHTML = `
                        <button class="delete-wish-btn" onclick="deleteWish(${wish.id})">
                            <i class="fas fa-times"></i>
                        </button>
                        <div class="wish-header-art">
                            <div class="wish-author-art">
                                <div class="author-avatar-art">
                                    ${wish.author.charAt(0)}
                                </div>
                                ${wish.author}
                            </div>
                            <div class="wish-time-art">${formatTime(new Date(wish.timestamp))}</div>
                        </div>
                        <div class="wish-content-art">${wish.content}</div>
                        ${imageHtml}
                    `;

                    container.appendChild(wishCard);
                });
            }

            // 删除祝福
            function deleteWish(id) {
                if (confirm('确定要删除这条祝福吗？')) {
                    deleteWishFromDatabase(id).then((success) => {
                        if (success) {
                            // 删除后重新加载数据
                            loadWishes();
                        }
                    });
                }
            }

            // 查看大图
            function viewImage(src) {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.9);
                    z-index: 1000;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    cursor: pointer;
                `;

                const img = document.createElement('img');
                img.src = src;
                img.style.cssText = `
                    max-width: 90%;
                    max-height: 90%;
                    border-radius: 10px;
                `;

                modal.appendChild(img);
                modal.onclick = () => document.body.removeChild(modal);
                document.body.appendChild(modal);
            }

            // ================================
            // 其他功能
            // ================================

            // 更新按钮状态
            function updateToggleButtons(type, enabled) {
                const onBtn = document.getElementById(`${type}OnBtn`);
                const offBtn = document.getElementById(`${type}OffBtn`);

                if (enabled) {
                    onBtn.classList.add('active');
                    offBtn.classList.remove('active');
                } else {
                    onBtn.classList.remove('active');
                    offBtn.classList.add('active');
                }
            }

            // 初始化年份导航
            function initializeYearNavigation() {
                const container = document.getElementById('yearNavigation');
                const startYear = 2026;
                const endYear = 2035;

                for (let year = startYear; year <= endYear; year++) {
                    const chip = document.createElement('div');
                    chip.className = `year-chip ${year === currentYear ? 'active' : ''}`;
                    chip.dataset.year = year;
                    chip.textContent = year;

                    chip.addEventListener('click', () => {
                        currentYear = year;

                        document.querySelectorAll('.year-chip').forEach(c => {
                            c.classList.toggle('active', parseInt(c.dataset.year) === year);
                        });

                        document.getElementById('targetYearDisplay').textContent = year;
                        loadWishes();

                        for (let i = 0; i < 2; i++) {
                            setTimeout(() => launchBigFirework(), i * 300);
                        }

                        createBlessingsCanvas();
                    });

                    container.appendChild(chip);
                }
            }

            // 倒计时
            function startCountdown() {
                function updateCountdown() {
                    const targetDate = new Date(currentYear, 0, 1, 0, 0, 0);
                    const now = new Date();
                    const diff = targetDate - now;

                    if (diff < 0) {
                        currentYear++;
                        document.getElementById('targetYearDisplay').textContent = currentYear;
                        return;
                    }

                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                    document.getElementById('countdownDays').textContent = days.toString().padStart(2, '0');
                    document.getElementById('countdownHours').textContent = hours.toString().padStart(2, '0');
                    document.getElementById('countdownMinutes').textContent = minutes.toString().padStart(2, '0');
                    document.getElementById('countdownSeconds').textContent = seconds.toString().padStart(2, '0');
                }

                updateCountdown();
                setInterval(updateCountdown, 1000);
            }

            // ================================
            // 初始化
            // ================================
            async function init() {
                console.log('=== 开始初始化应用 ===');

                // 1. 先初始化背景特效和字幕
                initializeSubtitles();
                createConstellation();
                createSnowGlobe();
                setupSpectacularFireworks();

                // 2. 初始化界面组件
                initializeYearNavigation();
                setupEventListeners();
                startCountdown();

                // 3. 测试Supabase连接并自动选择模式
                console.log('测试数据库连接...');
                const isConnected = await testSupabaseConnection();

                if (isConnected) {
                    console.log('数据库连接成功，使用云端模式');
                    dataMode = 'supabase';
                    document.getElementById('dataModeBtn').innerHTML = '<i class="fas fa-database"></i> 云端模式';
                    document.getElementById('dataModeBtn').classList.add('btn-art-active');
                    showToast('云端模式', '已连接到数据库，可互动交流', 'success');
                } else {
                    console.log('数据库连接失败，自动切换到本地模式');
                    dataMode = 'local';
                    document.getElementById('dataModeBtn').innerHTML = '<i class="fas fa-hdd"></i> 本地模式';
                    document.getElementById('dataModeBtn').classList.remove('btn-art-active');
                    document.getElementById('dataModeBtn').classList.add('btn-art-secondary');
                    showToast('本地模式', '使用本地存储，仅供个人使用', 'info');
                }

                // 4. 加载数据
                await loadWishes();

                console.log('=== 应用初始化完成 ===');
            }

            // 事件监听器
            function setupEventListeners() {
                // 发布祝福按钮
                document.getElementById('publishBlessingBtn').addEventListener('click', publishBlessing);

                // 清空按钮
                document.getElementById('clearInputsBtn').addEventListener('click', () => {
                    document.getElementById('authorInput').value = '';
                    document.getElementById('blessingInput').value = '';
                    document.getElementById('previewArt').style.display = 'none';
                    document.getElementById('imageUploadInput').value = '';
                    showToast('已清空', '输入内容已清空', 'info');
                });

                // 图片上传
                document.getElementById('uploadArt').addEventListener('click', () => {
                    document.getElementById('imageUploadInput').click();
                });

                document.getElementById('imageUploadInput').addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        if (file.size > 5 * 1024 * 1024) {
                            showToast('上传失败', '图片大小不能超过5MB', 'error');
                            return;
                        }

                        const reader = new FileReader();
                        reader.onload = function(e) {
                            document.getElementById('previewArtImg').src = e.target.result;
                            document.getElementById('previewArt').style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    }
                });

                // 移除图片
                document.getElementById('removePreviewBtn').addEventListener('click', () => {
                    document.getElementById('previewArt').style.display = 'none';
                    document.getElementById('imageUploadInput').value = '';
                });

                // 刷新祝福按钮
                document.getElementById('refreshBlessingsBtn').addEventListener('click', () => {
                    loadWishes();
                    showToast('已刷新', '祝福列表已更新', 'info');
                });

                // 数据模式切换按钮
                document.getElementById('dataModeBtn').addEventListener('click', toggleDataMode);

                // 分享按钮
                document.getElementById('shareWallBtn').addEventListener('click', showShareModal);

                // 特效控制
                document.getElementById('snowOnBtn').addEventListener('click', () => toggleSnow(true));
                document.getElementById('snowOffBtn').addEventListener('click', () => toggleSnow(false));
                document.getElementById('snowDensitySlider').addEventListener('input', (e) => updateSnowDensity(e.target.value));
                document.getElementById('snowSpeedSlider').addEventListener('input', (e) => updateSnowSpeed(e.target.value));

                document.getElementById('fireworksOnBtn').addEventListener('click', () => toggleFireworks(true));
                document.getElementById('fireworksOffBtn').addEventListener('click', () => toggleFireworks(false));
                document.getElementById('fireworksBurstBtn').addEventListener('click', burstFireworks);
                document.getElementById('fireworksFreqSlider').addEventListener('input', (e) => updateFireworksFrequency(e.target.value));
                document.getElementById('fireworksSizeSlider').addEventListener('input', (e) => updateFireworksSize(e.target.value));

                document.getElementById('wordsOnBtn').addEventListener('click', () => toggleWords(true));
                document.getElementById('wordsOffBtn').addEventListener('click', () => toggleWords(false));
                document.getElementById('refreshWordsBtn').addEventListener('click', () => {
                    createBlessingsCanvas();
                    showToast('字幕已刷新', '祝福字幕已重新生成', 'info');
                });
                document.getElementById('wordsDensitySlider').addEventListener('input', (e) => updateWordsDensity(e.target.value));
                document.getElementById('wordsSpeedSlider').addEventListener('input', (e) => updateWordsSpeed(e.target.value));
            }

            // 烟花辅助函数
            function createBigParticle(x, y, color) {
                const container = document.getElementById('fireworksDisplay');
                const particle = document.createElement('div');
                particle.className = 'firework-particle';

                const angle = Math.random() * Math.PI * 2;
                const distance = 50 + Math.random() * 70;
                const duration = 1.2 + Math.random() * 1;
                const size = 3 + Math.random() * 4;

                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance;

                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.background = color;
                particle.style.boxShadow = `0 0 ${size*3}px ${color}`;
                particle.style.setProperty('--tx', `${tx}px`);
                particle.style.setProperty('--ty', `${ty}px`);
                particle.style.animationDuration = `${duration}s`;

                container.appendChild(particle);

                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, duration * 1000);
            }

            function burstFireworks() {
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => launchBigFirework(), i * 200);
                }
                showToast('烟花绽放', '绽放了3朵绚丽烟花！', 'success');
            }

            function updateSnowDensity(value) {
                currentSnowCount = value;
                document.getElementById('snowDensityValue').textContent = `${value}%`;
                if (snowEnabled) createSnowGlobe();
            }

            function updateSnowSpeed(value) {
                const speedText = value < 4 ? '慢速' : value < 7 ? '中速' : '快速';
                document.getElementById('snowSpeedValue').textContent = speedText;
                if (snowEnabled) createSnowGlobe();
            }

            function toggleFireworks(enabled) {
                fireworksEnabled = enabled;
                const fireworksDisplay = document.getElementById('fireworksDisplay');

                if (enabled) {
                    setupSpectacularFireworks();
                    fireworksDisplay.style.display = 'block';
                    showToast('烟花特效', '烟花特效已开启', 'info');
                } else {
                    if (fireworksInterval) {
                        clearInterval(fireworksInterval);
                    }
                    fireworksDisplay.innerHTML = '';
                    fireworksDisplay.style.display = 'none';
                    showToast('烟花特效', '烟花特效已关闭', 'info');
                }

                updateToggleButtons('fireworks', enabled);
            }

            function updateFireworksFrequency(value) {
                currentFireworksFrequency = value;
                const freqText = value < 4 ? '稀少' : value < 7 ? '中等' : '频繁';
                document.getElementById('fireworksFreqValue').textContent = freqText;
                if (fireworksEnabled) setupSpectacularFireworks();
            }

            function updateFireworksSize(value) {
                const sizeText = value < 4 ? '小型' : value < 7 ? '中等' : '大型';
                document.getElementById('fireworksSizeValue').textContent = sizeText;
            }

            // 分享功能
            function showShareModal() {
                const modal = document.getElementById('shareModal');
                const linkInput = document.getElementById('shareLinkInput');

                linkInput.value = window.location.href;
                modal.style.display = 'flex';
            }

            function hideShareModal() {
                const modal = document.getElementById('shareModal');
                modal.style.display = 'none';
            }

            function copyLink() {
                const linkInput = document.getElementById('shareLinkInput');

                linkInput.select();
                linkInput.setSelectionRange(0, 99999);

                try {
                    document.execCommand('copy');
                    showToast('链接已复制', '网址链接已复制到剪贴板', 'success');
                } catch (err) {
                    navigator.clipboard.writeText(linkInput.value).then(() => {
                        showToast('链接已复制', '网址链接已复制到剪贴板', 'success');
                    }).catch(() => {
                        showToast('复制失败', '请手动复制链接', 'error');
                    });
                }

                window.getSelection().removeAllRanges();
            }

            function shareViaWeb() {
                if (navigator.share) {
                    navigator.share({
                        title: '时笺祝福墙',
                        text: '来时光祝福墙留下你的新年祝福',
                        url: window.location.href
                    }).then(() => {
                        showToast('分享成功', '内容已分享', 'success');
                    }).catch(() => {
                        // 用户取消分享
                    });
                } else {
                    copyLink();
                }
            }

            // ================================
            // 页面加载
            // ================================
            window.addEventListener('load', init);

            // 响应式调整
            window.addEventListener('resize', () => {
                createConstellation();
                createSnowGlobe();
                createBlessingsCanvas();
            });

            // 将分享相关函数暴露给全局作用域
            window.hideShareModal = hideShareModal;
            window.copyLink = copyLink;
            window.shareViaWeb = shareViaWeb;
        </script>
        <!-- Supabase 客户端库 -->
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    </body>
</html>